@using BlackMesa.Utilities
@model BlackMesa.Models.Entry

<script type="text/javascript">
    $(function () {
        // Initialize DateCreatedPicker
        $('#DateCreatedPicker').datetimepicker({
            language: 'en-US'
        });
        var dateCreatedPicker = $('#DateCreatedPicker').data('datetimepicker');
        
        // Initialize DateEditedPicker
        $('#DateEditedPicker').datetimepicker({
            language: 'en-US'
        });
        var dateEditedPicker = $('#DateEditedPicker').data('datetimepicker');
        
        // If we are about to create a new Entry, the initial value for the datetime fields should be the current date. 
        // If we are changing an existing entry we want the datetime fields to be initialized we the data from the database.
        @{
            long dateCreatedToUse;
            long dateEditedToUse;
            if (Model == null)
            {
                dateCreatedToUse = DateTime.Now.ToJavaScriptMilliseconds();
                dateEditedToUse = DateTime.Now.ToJavaScriptMilliseconds();
            }
            else
            {
                dateCreatedToUse = Model.DateCreated.ToJavaScriptMilliseconds();
                dateEditedToUse = Model.DateEdited.ToJavaScriptMilliseconds();
            }
        }
        
        dateCreatedPicker.setLocalDate(new Date(@dateCreatedToUse));
        dateEditedPicker.setLocalDate(new Date(@dateEditedToUse));

        jQuery(".tag-input").tagsManager({
            prefilled: [@Html.Raw(Model != null ? String.Join(", ", Model.Tags.Select(t=> "\"" + t.Name + "\"")) : "")],
            typeahead: true,
            typeaheadAjaxSource: "@Url.Action("Json","Tag")",
            typeaheadAjaxPolling: true,
        });
        
    });

    
</script>